

# End-to-End Bulk RNA-Seq Pipeline (CRC · PRJNA413956)

A reproducible workflow to process raw RNA-seq reads from the colorectal cancer (CRC) study **PRJNA413956** and perform downstream exploratory analysis with **PySpark**.  
The pipeline runs from SRA → trimmed FASTQ → **Salmon** quantification → expression/sequence integration (GC%) → summary plots.

---

## Data source

- **BioProject:** PRJNA413956 — “Differentially expressed lncRNAs and mRNA identified by SEQ analysis in colorectal cancer patients.”
- **GEO Series:** GSE104836 — 10 paired tissues (non-tumor and CRC) generated by deep sequencing.
- Links: BioProject page (NCBI) and GEO series page.

> Note: raw FASTQ are obtained from SRA; quantification is performed against a GENCODE transcriptome.

---

## Repository layout

```

PRJNA413956/
├── PRJNA413956.ipynb        # PySpark/pyfastx analysis notebook (GC%, Δlog10(TPM), etc.)
├── README.md                # This file
├── gencode.v46.transcripts.fa
├── gencode.v46.transcripts.fa.fxi   # pyfastx index (generated)
├── quants/                  # Salmon results: one subfolder per SRR*_quant (not tracked by git LFS by default)
└── _cache/                  # Local scratch (safe to delete; not required for publication)

````

---

## Requirements

Run on Linux (or WSL). A Conda environment is recommended.

```yaml
# environment.yml
name: rnaseq
channels: [conda-forge, bioconda, defaults]
dependencies:
  - python=3.10
  - pyspark
  - pandas
  - matplotlib
  - seaborn
  - pyfastx
  - entrez-direct
  - sra-tools
  - trim-galore
  - salmon
  - parallel
````

**Setup**

```bash
conda env create -f environment.yml
conda activate rnaseq
```

**Reference files**

* A **Salmon index** built from a transcriptome (e.g., GENCODE).
* The corresponding **FASTA** (e.g., `gencode.v46.transcripts.fa`) for sequence-level features (GC%).

---

## 1) Command-line processing (SRA → Salmon)

From the project root:

```bash
#!/usr/bin/env bash
set -euo pipefail

# 1) Fetch SRR accessions (PRJNA413956)
esearch -db sra -query PRJNA413956 \
  | efetch -format runinfo \
  | cut -d',' -f1 \
  | grep '^SRR' > prjna413956_srr_ids.txt

# 2) Download in parallel
cat prjna413956_srr_ids.txt | parallel -j 4 'prefetch --verify no {}'

# 3) Convert + trim
cat prjna413956_srr_ids.txt | while read SRR; do
  fastq-dump --split-files --gzip "$SRR"
  trim_galore --paired --fastqc --cores 4 "${SRR}_1.fastq.gz" "${SRR}_2.fastq.gz"
done

# 4) Quantify with Salmon
mkdir -p quants
for R1 in *_1_val_1.fq.gz; do
  SAMPLE="${R1%_1_val_1.fq.gz}"
  salmon quant \
    -i /path/to/salmon_index \
    -l A \
    -1 "${SAMPLE}_1_val_1.fq.gz" \
    -2 "${SAMPLE}_2_val_2.fq.gz" \
    --validateMappings -p 8 \
    -o "quants/${SAMPLE}_quant"
done

echo "Pipeline complete."
```

**Output structure per sample (Salmon)**

```
quants/SRRxxxxxxx_quant/
├── quant.sf
├── cmd_info.json
└── lib_format_counts.json
```

---

## 2) Downstream analysis (PySpark + pyfastx)

Open and run **`PRJNA413956.ipynb`** to:

1. Load all `quant.sf` into a Spark table (`expression_all_samples`).
2. Parse transcript GC% and length from `gencode.v46.transcripts.fa` via **pyfastx** (`sequence_features`).
3. Generate:

   * Average expression vs. GC% scatter/summary plots.
   * Tumor-only per-sample **GC-bias split** and **Δlog10(TPM) vs GC%** (“volcano-like”) plots.
   * Binned GC% trends contrasting Tumor vs. Normal (when Normal quant files are available).

The notebook writes only temporary artifacts to `_cache/` (safe to delete).

---

## Outputs

* **Figures/plots** produced in the notebook (saved within the notebook).
* **`quants/`**: all Salmon quantifications (one directory per SRR).
* Optional **manifest** (if created): a CSV listing SRR → file paths for portability/archive.

---

## Reproducibility notes

* `quant.sf` originates from Salmon; `cmd_info.json` and `lib_format_counts.json` retain basic provenance.
* `_cache/` is local scratch and can be removed.
* For archival (e.g., Zenodo), include:

  * `quants/*/quant.sf`
  * `quants/*/cmd_info.json`
  * `quants/*/lib_format_counts.json`
  * A simple `quants_manifest.csv` mapping SRR to files.

Example manifest creation:

```bash
{
  echo "Sample,quant_sf,cmd_info,lib_format_counts"
  for d in quants/SRR*_quant; do
    s=$(basename "$d")
    echo "$s,$d/quant.sf,$d/cmd_info.json,$d/lib_format_counts.json"
  done
} > quants_manifest.csv
```

---

## Citation & licensing

* **Source study**:
  *Li M., Wang G., et al.* (2017). *Differentially expressed lncRNAs and mRNA identified by SEQ analysis in colorectal cancer patients.*
  BioProject **PRJNA413956** / Series **GSE104836** (NCBI).

* **Reuse**: Please cite the original PRJNA413956 study when re-using these quantifications.
  Data assets may be shared under **CC BY 4.0**; embedded code snippets under **MIT**.

Suggested citation text:

> Li M., Wang G., et al. (2017) Differentially expressed lncRNAs and mRNA identified by SEQ analysis in colorectal cancer patients. Dataset associated with BioProject PRJNA413956 / Series GSE104836. CC BY 4.0. NCBI BioProject: PRJNA413956.

---

## Acknowledgements

* GENCODE transcriptome for reference sequences.
* Salmon, Trim Galore!, SRA-Toolkit, pyfastx, PySpark, pandas, matplotlib, seaborn.

```

If you want the environment block split into **minimal runtime** (notebook-only) and **full CLI** toolsets, say the word and I’ll add a second `environment-min.yml`.
::contentReference[oaicite:0]{index=0}
```
